<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>gonglee ì´ìƒí˜• ì›”ë“œì»µ</title>
    <style>
        :root {
            --primary-color: #A68B5E;
            --background-color: #f4f4f4;
            --card-background: #FFFFFF;
            --border-color: #E0E0E0;
            --text-color: #333333;
            --logo-color: #A68B5E;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        /* --- ë„¤ë¹„ê²Œì´ì…˜ ë°” ìŠ¤íƒ€ì¼ --- */
        .navbar {
            background: var(--card-background);
            border-bottom: 1px solid var(--border-color);
            padding: 0;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.08);
            position: sticky;
            top: 0;
            z-index: 100;
        }

        .navbar-container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            height: 60px;
        }

        .navbar-logo {
            font-size: 20px;
            font-weight: 600;
            color: var(--primary-color);
            text-decoration: none;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .navbar-logo:hover {
            opacity: 0.8;
        }

        .navbar-menu {
            display: flex;
            gap: 30px;
            list-style: none;
        }

        .navbar-menu a {
            color: var(--text-color);
            text-decoration: none;
            font-size: 14px;
            font-weight: 500;
            transition: color 0.2s ease;
            cursor: pointer;
        }

        .navbar-menu a:hover {
            color: var(--primary-color);
        }

        .navbar-menu a.active {
            color: var(--primary-color);
            border-bottom: 2px solid var(--primary-color);
            padding-bottom: 4px;
        }

        .navbar-toggle {
            display: none;
            background: none;
            border: none;
            font-size: 24px;
            cursor: pointer;
            color: var(--text-color);
        }

        @media (max-width: 768px) {
            .navbar-menu {
                display: none;
                position: absolute;
                top: 60px;
                left: 0;
                right: 0;
                flex-direction: column;
                gap: 0;
                background: var(--card-background);
                border-bottom: 1px solid var(--border-color);
                padding: 20px;
            }

            .navbar-menu.active {
                display: flex;
            }

            .navbar-menu a {
                padding: 12px 0;
                border-bottom: 1px solid var(--border-color);
            }

            .navbar-toggle {
                display: block;
            }
        }

        html {
            background-color: var(--background-color);
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: var(--background-color);
            min-height: 100vh;
            color: var(--text-color);
            line-height: 1.6;
            margin: 0;
        }

        .main-content {
            padding: 0;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: calc(100vh - 60px);
        }

        .container {
            max-width: 1200px;
            width: 100%;
            padding: 0;
            text-align: center;
        }

        /* --- ì˜¨ë³´ë”© í˜ì´ì§€ ìŠ¤íƒ€ì¼ (ì´ë¯¸ì§€ í’€ìŠ¤í¬ë¦°) --- */
        .onboarding-page {
            background: var(--background-color);
            padding: 0;
            margin: 0;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            height: calc(100vh - 60px);
            width: 100%;
            overflow: hidden;
        }

        .logo-container {
            text-align: center;
            padding: 0;
            width: 100%;
            height: 90%;
            display: flex;
            justify-content: center;
            align-items: center;
            transition: all 0.3s ease-in-out;
            background-color: var(--background-color);
            overflow: hidden;
        }

        .logo-link {
            text-decoration: none;
            display: flex;
            justify-content: center;
            align-items: center;
            width: 100%;
            height: 100%;
            cursor: pointer;
        }

        .logo-image {
            cursor: pointer;
            width: 100%;
            height: 100%;
            object-fit: contain;
            background-color: var(--background-color);
            transition: transform 0.3s ease, opacity 0.3s ease;
        }

        .logo-link:hover .logo-image {
            transform: scale(1.02);
            opacity: 0.95;
        }

        .onboarding-description {
            width: 100%;
            height: 10%;
            background-color: var(--background-color);
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 0 20px;
            text-align: center;
        }

        .description {
            color: #777;
            font-size: 16px;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: var(--background-color);
            padding: 5px 10px;
            border-radius: 5px;
            margin: 0;
        }

        .description a {
            color: var(--logo-color);
            font-weight: bold;
            text-decoration: none;
            cursor: pointer;
            transition: color 0.2s ease;
        }

        .description a:hover {
            opacity: 0.8;
        }

        /* --- ì›”ë“œì»µ í˜ì´ì§€ --- */
        .selection-group, .worldcup-page, .result-page {
            background: var(--card-background);
            border-radius: 4px;
            box-shadow: 0 5px 20px rgba(0, 0, 0, 0.1);
            padding: 40px;
            margin: 0 20px 30px 20px;
        }

        h1 {
            color: var(--primary-color);
            font-weight: 300;
            margin-bottom: 20px;
            font-size: 32px;
        }

        h2 {
            color: var(--text-color);
            font-weight: 400;
            margin-bottom: 20px;
            font-size: 24px;
            border-bottom: 1px solid var(--border-color);
            padding-bottom: 10px;
        }

        p {
            color: #666;
            margin-bottom: 20px;
        }

        .button-group {
            display: flex;
            justify-content: center;
            gap: 15px;
            margin-top: 15px;
            flex-wrap: wrap;
        }

        .btn, .start-btn, .next-btn, .restart-btn {
            padding: 12px 25px;
            border: 1px solid var(--border-color);
            border-radius: 4px;
            cursor: pointer;
            font-size: 16px;
            font-weight: 500;
            transition: all 0.2s ease;
            background: var(--card-background);
            color: var(--text-color);
            text-decoration: none;
            display: inline-block;
        }

        .btn.active {
            background: var(--primary-color);
            color: white;
            border-color: var(--primary-color);
        }

        .btn:not(.active):hover {
            border-color: var(--primary-color);
            color: var(--primary-color);
        }

        .start-btn, .next-btn, .restart-btn {
            background: var(--primary-color);
            color: white;
            border: none;
            margin-top: 30px;
            padding: 15px 40px;
            font-size: 16px;
        }

        .start-btn:hover, .next-btn:hover, .restart-btn:hover {
            opacity: 0.9;
            transform: translateY(-1px);
            box-shadow: 0 5px 15px rgba(166, 139, 94, 0.4);
        }

        .start-btn:disabled, .next-btn:disabled {
            background: #ccc;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }

        .battle-container {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-top: 40px;
        }

        .candidate-card {
            background: var(--card-background);
            border: 2px solid var(--border-color);
            border-radius: 4px;
            padding: 20px;
            cursor: pointer;
            transition: all 0.3s ease;
            height: 100%;
            display: flex;
            flex-direction: column;
            justify-content: space-between;
            overflow: hidden;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05);
        }

        .candidate-card:hover {
            border-color: var(--primary-color);
            box-shadow: 0 5px 15px rgba(166, 139, 94, 0.2);
            transform: translateY(-2px);
        }

        .candidate-card.selected {
            border-color: var(--primary-color);
            box-shadow: 0 0 0 5px rgba(166, 139, 94, 0.2);
            background: #FFFBF7;
        }

        .candidate-image {
            width: 100%;
            height: auto;
            max-height: 400px;
            object-fit: cover;
            border-radius: 2px;
            margin-bottom: 15px;
            border: 1px solid var(--border-color);
        }

        .candidate-name {
            font-size: 20px;
            font-weight: 600;
            color: var(--primary-color);
            margin-bottom: 5px;
        }

        .candidate-info {
            font-size: 14px;
            color: #999;
        }

        .round-info {
            margin-bottom: 20px;
        }

        .round-info h2 {
            font-size: 36px;
            font-weight: 300;
            color: var(--text-color);
            border-bottom: none;
        }

        .round-info p {
            font-size: 18px;
            color: #666;
        }

        .winner-card {
            display: inline-block;
            padding: 30px;
            background: var(--card-background);
            border: 3px solid var(--primary-color);
            border-radius: 4px;
            margin-top: 20px;
            box-shadow: 0 10px 30px rgba(166, 139, 94, 0.3);
            max-width: 400px;
        }

        .trophy {
            font-size: 50px;
            margin-bottom: 15px;
        }

        .winner-image {
            width: 100%;
            max-width: 300px;
            height: auto;
            border-radius: 4px;
            margin-bottom: 15px;
            border: 2px solid var(--primary-color);
        }

        .winner-name {
            font-size: 28px;
            font-weight: 700;
            color: var(--primary-color);
        }

        .winner-info {
            font-size: 16px;
            color: #666;
            margin-top: 5px;
        }

        .loading {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 50px;
        }

        .spinner {
            border: 4px solid var(--border-color);
            border-top: 4px solid var(--primary-color);
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin-bottom: 15px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        @media (max-width: 768px) {
            .logo-container {
                height: 80%;
            }

            .onboarding-description {
                height: 20%;
            }

            .description {
                font-size: 14px;
            }

            h1 {
                font-size: 24px;
            }

            .battle-container {
                grid-template-columns: 1fr;
            }

            .selection-group, .worldcup-page, .result-page {
                margin: 0 10px 30px 10px;
                padding: 20px;
            }
        }
    </style>
</head>
<body>
<nav class="navbar" id="navbar" style="display:none;">
    <div class="navbar-container">
        <a href="/" class="navbar-logo">
            ğŸ† gonglee
        </a>
        <ul class="navbar-menu" id="navbarMenu">
            <li><a href="javascript:void(0)" onclick="handleWorldcupClick()">ì´ìƒí˜• ì›”ë“œì»µ</a></li>
            <li><a href="/questions">ì§ˆë¬¸ ëª©ë¡</a></li>
            <li><a href="/questions/new">ì§ˆë¬¸ ìƒì„±</a></li>
        </ul>
        <button class="navbar-toggle" id="navbarToggle">â˜°</button>
    </div>
</nav>

<div class="main-content">
    <div class="container">
        <!-- ì˜¨ë³´ë”© í˜ì´ì§€ (ì´ë¯¸ì§€ í’€ìŠ¤í¬ë¦°) -->
        <div class="onboarding-page" id="onboardingPage">
            <div class="logo-container">
                <a href="javascript:void(0)" onclick="startWorldcup()" class="logo-link">
                    <img th:src="@{/images/Gemini_Generated_Image_wh0wzswh0wzswh0w (1).png}"
                         alt="gonglee ì´ìƒí˜• ì›”ë“œì»µ (í´ë¦­í•˜ì—¬ ì‹œì‘)"
                         class="logo-image">
                </a>
            </div>
            <div class="onboarding-description">
                <p class="description">
                    í´ë¦­í•˜ì—¬ <a onclick="startWorldcup()">ì´ìƒí˜• ì›”ë“œì»µ</a>ì„ ì‹œì‘í•˜ì„¸ìš”
                </p>
            </div>
        </div>

        <!-- ì›”ë“œì»µ í˜ì´ì§€ (ì´ìƒí˜• ì„ íƒ) -->
        <div class="worldcup-page" id="worldcupPage" style="display:none;">
            <h1>ğŸ† gonglee's Ideal Type World Cup</h1>
            <p>ë‹¹ì‹ ì˜ ì´ìƒí˜•ì„ ì°¾ì•„ë³´ì„¸ìš”!</p>

            <div class="selection-group">
                <h2>ğŸ‘¤ ì„±ë³„ ì„ íƒ</h2>
                <div class="button-group">
                    <button class="btn" data-gender="male">ğŸ‘¨ ë‚¨ì„±</button>
                    <button class="btn" data-gender="female">ğŸ‘© ì—¬ì„±</button>
                </div>
            </div>

            <div class="selection-group">
                <h2>âœ¨ ì¹´í…Œê³ ë¦¬ ì„ íƒ</h2>
                <div class="button-group">
                    <button class="btn" data-category="idol">â­ ì•„ì´ëŒ</button>
                    <button class="btn" data-category="actor">ğŸ¬ ë°°ìš°</button>
                </div>
            </div>

            <button class="start-btn" id="startBtn" disabled>ì›”ë“œì»µ ì‹œì‘í•˜ê¸°</button>
        </div>

        <!-- ê²Œì„ ì§„í–‰ í˜ì´ì§€ -->
        <div class="worldcup-page" id="gamePlayPage" style="display:none;">
            <div class="round-info">
                <h2 id="roundTitle">32ê°•</h2>
                <p id="roundDesc">ë‘ ëª… ì¤‘ ë” ì¢‹ì•„í•˜ëŠ” ì‚¬ëŒì„ ì„ íƒí•˜ì„¸ìš”</p>
            </div>

            <div class="loading" id="loading" style="display:none;">
                <div class="spinner"></div>
                <p>ë¡œë”© ì¤‘...</p>
            </div>

            <div class="battle-container" id="battleContainer">
                <div class="candidate-card" id="card1" data-index="0">
                    <img class="candidate-image" id="image1"
                         src="https://via.placeholder.com/500x750?text=Option+A"
                         alt="í›„ë³´ ì´ë¯¸ì§€">
                    <div class="candidate-name" id="name1">í›„ë³´ ì´ë¦„ A</div>
                    <div class="candidate-info" id="info1">ì†Œì†/ì‘í’ˆëª… A</div>
                </div>

                <div class="candidate-card" id="card2" data-index="1">
                    <img class="candidate-image" id="image2"
                         src="https://via.placeholder.com/500x750?text=Option+B"
                         alt="í›„ë³´ ì´ë¯¸ì§€">
                    <div class="candidate-name" id="name2">í›„ë³´ ì´ë¦„ B</div>
                    <div class="candidate-info" id="info2">ì†Œì†/ì‘í’ˆëª… B</div>
                </div>
            </div>

            <button class="next-btn" id="nextBtn" disabled>ë‹¤ìŒ ë¼ìš´ë“œ ì§„ì¶œ!</button>
        </div>

        <!-- ê²°ê³¼ í˜ì´ì§€ -->
        <div class="result-page" id="resultPage" style="display:none;">
            <h1>ğŸ‰ ìµœì¢… ìš°ìŠ¹ì ê²°ì •!</h1>

            <div class="winner-card">
                <div class="trophy">ğŸ†</div>
                <img class="winner-image" id="winnerImage"
                     src="https://via.placeholder.com/500x750?text=WINNER"
                     alt="ìš°ìŠ¹ì ì´ë¯¸ì§€">
                <div class="winner-name" id="winnerName">ìµœì¢… ìš°ìŠ¹ì</div>
                <div class="winner-info" id="winnerInfo">ì†Œì†/ì‘í’ˆëª…</div>
            </div>

            <button class="restart-btn" id="restartBtn">ë‹¤ì‹œ ì‹œì‘í•˜ê¸°</button>
        </div>
    </div>
</div>

<script>
    let selectedGender = null;
    let selectedCategory = null;

    let candidates = [];
    let currentRoundCandidates = [];
    let nextRoundCandidates = [];
    let selectedCandidate = null;
    let matchIndex = 0;

    const API_BASE = '/api/worldcup';

    const onboardingPage = document.getElementById('onboardingPage');
    const worldcupPage = document.getElementById('worldcupPage');
    const gamePlayPage = document.getElementById('gamePlayPage');
    const resultPage = document.getElementById('resultPage');
    const navbar = document.getElementById('navbar');
    const loading = document.getElementById('loading');
    const genderBtns = document.querySelectorAll('[data-gender]');
    const categoryBtns = document.querySelectorAll('[data-category]');
    const startBtn = document.getElementById('startBtn');
    const nextBtn = document.getElementById('nextBtn');
    const card1 = document.getElementById('card1');
    const card2 = document.getElementById('card2');
    const restartBtn = document.getElementById('restartBtn');
    const navbarToggle = document.getElementById('navbarToggle');
    const navbarMenu = document.getElementById('navbarMenu');

    navbarToggle.addEventListener('click', () => {
        navbarMenu.classList.toggle('active');
    });

    document.querySelectorAll('.navbar-menu a').forEach(link => {
        link.addEventListener('click', () => {
            navbarMenu.classList.remove('active');
        });
    });

    // ì˜¨ë³´ë”©ì—ì„œ ì›”ë“œì»µ ì‹œì‘
    function startWorldcup() {
        showPage('worldcup');
    }

    // ë„¤ë¹„ê²Œì´ì…˜ active ì—…ë°ì´íŠ¸
    function updateNavActive(page) {
        document.querySelectorAll('.navbar-menu a').forEach(link => {
            link.classList.remove('active');
        });

        if (page === 'worldcup') {
            document.querySelector('[onclick="handleWorldcupClick()"]').classList.add('active');
        }
    }

    // ì´ìƒí˜• ì›”ë“œì»µ ë§í¬ í´ë¦­ í•¸ë“¤ëŸ¬
    function handleWorldcupClick() {
        showPage('worldcup');
        updateNavActive('worldcup');
    }

    function shuffleArray(array) {
        for (let i = array.length - 1; i > 0; i--) {
            const j = Math.floor(Math.random() * (i + 1));
            [array[i], array[j]] = [array[j], array[i]];
        }
        return array;
    }

    function updateStartBtn() {
        startBtn.disabled = !selectedGender || !selectedCategory;
    }

    genderBtns.forEach(btn => {
        btn.addEventListener('click', (e) => {
            genderBtns.forEach(b => b.classList.remove('active'));
            e.target.classList.add('active');
            selectedGender = e.target.dataset.gender;
            updateStartBtn();
        });
    });

    categoryBtns.forEach(btn => {
        btn.addEventListener('click', (e) => {
            categoryBtns.forEach(b => b.classList.remove('active'));
            e.target.classList.add('active');
            selectedCategory = e.target.dataset.category;
            updateStartBtn();
        });
    });

    startBtn.addEventListener('click', startTournament);
    nextBtn.addEventListener('click', processNextMatch);
    restartBtn.addEventListener('click', restartGame);

    async function startTournament() {
        try {
            showPage('gameplay');
            showLoading(true);

            const response = await fetch(
                `${API_BASE}/start?tour=${selectedGender}&cat=${selectedCategory}`
            );
            candidates = await response.json();

            currentRoundCandidates = shuffleArray([...candidates]);
            nextRoundCandidates = [];
            matchIndex = 0;

            loadNextMatchup();
        } catch (error) {
            console.error('Error:', error);
            alert('ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤. ì„œë²„ë¥¼ í™•ì¸í•´ì£¼ì„¸ìš”.');
            showPage('worldcup');
        } finally {
            showLoading(false);
        }
    }

    function loadNextMatchup() {
        const totalCandidates = currentRoundCandidates.length;

        if (totalCandidates === 1) {
            showWinner(currentRoundCandidates[0]);
            return;
        }

        if (matchIndex >= totalCandidates) {
            currentRoundCandidates = nextRoundCandidates;
            nextRoundCandidates = [];
            matchIndex = 0;
            return loadNextMatchup();
        }

        const roundName = getRoundName(totalCandidates);
        document.getElementById('roundTitle').textContent = roundName;
        document.getElementById('roundDesc').textContent =
            `${roundName} (${matchIndex / 2 + 1} / ${totalCandidates / 2})ë²ˆì§¸ ëŒ€ê²°`;

        const candidate1 = currentRoundCandidates[matchIndex];
        const candidate2 = currentRoundCandidates[matchIndex + 1];

        displayCandidate('1', candidate1);
        displayCandidate('2', candidate2);

        selectedCandidate = null;
        card1.classList.remove('selected');
        card2.classList.remove('selected');
        nextBtn.disabled = true;

        card1.onclick = () => selectCandidate(candidate1, 'card1');
        card2.onclick = () => selectCandidate(candidate2, 'card2');
    }

    function displayCandidate(num, candidate) {
        const imageUrl = candidate.image_url ||
            'https://via.placeholder.com/500x750?text=NO+IMAGE';
        document.getElementById('image' + num).src = imageUrl;
        document.getElementById('name' + num).textContent = candidate.name;
        document.getElementById('info' + num).textContent =
            candidate.group_or_work || 'ì •ë³´ ì—†ìŒ';
    }

    function selectCandidate(candidate, cardId) {
        selectedCandidate = candidate;

        card1.classList.remove('selected');
        card2.classList.remove('selected');
        document.getElementById(cardId).classList.add('selected');

        nextBtn.disabled = false;
    }

    function processNextMatch() {
        if (selectedCandidate) {
            nextRoundCandidates.push(selectedCandidate);
            matchIndex += 2;
            loadNextMatchup();
        }
    }

    function getRoundName(count) {
        const roundMap = {
            32: '32ê°•',
            16: '16ê°•',
            8: '8ê°•',
            4: '4ê°•',
            2: 'ê²°ìŠ¹',
            1: 'ìš°ìŠ¹ì'
        };
        return roundMap[count] || `${count}ê°•`;
    }

    function showWinner(winner) {
        showPage('result');

        const winnerImage = document.getElementById('winnerImage');
        const imageUrl = winner.image_url ||
            'https://via.placeholder.com/500x750?text=WINNER';
        winnerImage.src = imageUrl;
        document.getElementById('winnerName').textContent = winner.name;
        document.getElementById('winnerInfo').textContent =
            winner.group_or_work || 'ì •ë³´ ì—†ìŒ';
    }

    function showPage(page) {
        onboardingPage.style.display = 'none';
        worldcupPage.style.display = 'none';
        gamePlayPage.style.display = 'none';
        resultPage.style.display = 'none';
        navbar.style.display = 'none';

        if (page === 'onboarding') {
            onboardingPage.style.display = 'flex';
        } else if (page === 'worldcup') {
            worldcupPage.style.display = 'block';
            navbar.style.display = 'block';
            updateNavActive('worldcup');
        } else if (page === 'gameplay') {
            gamePlayPage.style.display = 'block';
            navbar.style.display = 'block';
            updateNavActive('worldcup');
        } else if (page === 'result') {
            resultPage.style.display = 'block';
            navbar.style.display = 'block';
            updateNavActive('worldcup');
        }
    }

    function restartGame() {
        selectedGender = null;
        selectedCategory = null;
        nextRoundCandidates = [];
        currentRoundCandidates = [];
        selectedCandidate = null;
        matchIndex = 0;

        genderBtns.forEach(b => b.classList.remove('active'));
        categoryBtns.forEach(b => b.classList.remove('active'));

        showPage('onboarding');
        updateStartBtn();
    }

    function showLoading(show) {
        loading.style.display = show ? 'flex' : 'none';
        document.getElementById('battleContainer').style.display =
            show ? 'none' : 'grid';
        document.getElementById('nextBtn').style.display =
            show ? 'none' : 'block';
    }

    document.addEventListener('DOMContentLoaded', () => {
        updateStartBtn();
        showPage('onboarding');
    });
</script>
</body>
</html>